<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE HTML PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
          "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en-US">
<head>
		<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <script src="./../../../../../../../Include/Javascript/common_en-US.js" type="text/javascript"></script>
	<script type="text/javascript">
		var time = new Date(0);
		var preview = false;
		var relativeHTMLPath = "./../../../../../../../";
				var pageid = 0;
				var heroimage = "./../../../../../../../Images/ue5-hero.png";
				var lang = "en-US";
				var basePath = document.location.pathname.substring(0, document.location.pathname.indexOf('/' + lang + '/') + lang.length + 1);
		document.write('<base href="' +  encodeURI(basePath) + '/API/Runtime/Engine/Net/FObjectReplicator/ReceivedNak/" />');
				var udnCSS = './../../../../../../../Include/CSS/udn_public.css';
		var udnLangCSS = '';
				var udnOverrideCSS = './../../../../../../../Include/CSS/skin_overrides.css';
		var udnOverrideDarkCSS = './../../../../../../../Include/CSS/skin_overrides_dark.css';
		var fancyboxCSS = './../../../../../../../Include/CSS/jquery.fancybox.css';
		var jqueryuiCSS = './../../../../../../../Include/CSS/jquery-ui.min.css';
		var qtipCSS = './../../../../../../../Include/CSS/jquery.qtip.css';
		var prettifyCSS = './../../../../../../../Include/CSS/prettify.css';
		var navbarCSS = './../../../../../../../Include/CSS/navBar.css';
		var twentytwentyCSS = './../../../../../../../Include/CSS/twentytwenty.css';
		var recommendationsCSS = './../../../../../../../Include/CSS/jquery.recommendations.css';
	</script>
    <title>FObjectReplicator::ReceivedNak | Unreal Engine 5.2 Documentation</title>
    	    <meta name=viewport content="width=device-width, initial-scale=1" />
	<meta http-equiv="Cache-control" content="no-store">
    <script  src="./../../../../../../../Include/Javascript/CustomEvent.js" type="text/javascript"></script>
    <script  src="./../../../../../../../Include/Javascript/jquery-3.4.0.min.js" type="text/javascript"></script>
    <script  src="./../../../../../../../Include/Javascript/udn.js" type="text/javascript"></script>
    <script  src="./../../../../../../../Include/Javascript/udn_extras.js" type="text/javascript"></script>
    <script  src="./../../../../../../../Include/Javascript/jquery-ui.min.js" type="text/javascript"></script>
	    <script  src="./../../../../../../../Include/Javascript/informational.js" type="text/javascript"></script>
	    <script  src="./../../../../../../../Include/Javascript/jquery.fancybox.pack.js" type="text/javascript"></script>
    <script  src="./../../../../../../../Include/Javascript/jquery.qtip.js" type="text/javascript"></script>
    <script  src="./../../../../../../../Include/Javascript/prettify.js" type="text/javascript"></script>
    <script  src="./../../../../../../../Include/Javascript/jquery.slimscroll.js" type="text/javascript"></script>
    <script  src="./../../../../../../../Include/Javascript/jquery.event.move.js" type="text/javascript"></script>
    <script  src="./../../../../../../../Include/Javascript/jquery.twentytwenty.js" type="text/javascript"></script>
    <script  src="./../../../../../../../Include/Javascript/lazysizes.min.js" type="text/javascript"></script>
	    <script  src="./../../../../../../../Include/Javascript/jquery.recommendations.js" type="text/javascript"></script>
	
    <link async rel="icon" href="./../../../../../../../Include/Images/site_icon.png" type="image/x-icon" />
    <link async rel="shortcut icon" href="./../../../../../../../Include/Images/site_icon.png" type="image/x-icon" />
    <link async href="./../../../../../../../Include/Images/touch_icon.png" rel="apple-touch-icon" />
    <link async href="./../../../../../../../Include/Images/touch_icon_114.png" sizes="114x114" rel="apple-touch-icon" />    
		<script  src="./../../../../../../../Include/Javascript/CollapsibleLists.js" type="text/javascript"></script>
	<script  src="./../../../../../../../Include/Javascript/navigationBarUI.js"></script>
	<script  src="./../../../../../../../Include/Javascript/navigationBar.js"></script>
		
	<link rel="alternate" href="https://docs.unrealengine.com/latest/en-US/API/Runtime/Engine/Net/FObjectReplicator/ReceivedNak/" hreflang="x-default" />

	<meta name="title" content="FObjectReplicator::ReceivedNak" />
<meta name="description" content="Packet was dropped" />
<meta name="availability" content="Public" />
<meta name="crumbs" content="%ROOT%,API,API/Runtime,API/Runtime/Engine,API/Runtime/Engine/Net,API/Runtime/Engine/Net/FObjectReplicator" />

	<meta name="twitter:card" content="summary_large_image" />
	<meta property="og:title" content="FObjectReplicator::ReceivedNak" />
	<meta property="og:description" content="Packet was dropped" />
		<meta property="og:image" content="https://docs.unrealengine.com/5.1/Images/placeholder-social.png" />
	</head>
<body id="webbgThree" style="visibility: hidden;" onload="document.body.style.visibility='visible';">
			<script>window.__tracking_base = 'https://tracking.unrealengine.com';</script>
	<script src="https://tracking.unrealengine.com/tracking.js" async></script>    <div id="webThree">
				<div id="page_head">
						<div id="head">
				<div id="logo"></div>
			</div>
						<div id="pagenav">
				<div class="crumbs" id="crumbs">
<span id="versionContainer">
	<span id="versionSelect" class="btn btn-version" onclick="ToggleMenu($('#versionMenu'), $(this));"></span>
	<div id="versionMenu">
		<div id="4_26" data-version="4.26" class="btn btn-select" onclick="createCookie('version', '4.26', 365);SwitchVersion('4.26');">Unreal Engine 4.26 Documentation</div>
		<div id="4_27" data-version="4.27" class="btn btn-select" onclick="createCookie('version', '4.27', 365);SwitchVersion('4.27');">Unreal Engine 4.27 Documentation</div>
		<div id="5_0" data-version="5.0" class="btn btn-select" onclick="createCookie('version', '5.0', 365);SwitchVersion('5.0');">Unreal Engine 5.0 Documentation</div>
		<div id="5_1" data-version="5.1" class="btn btn-select" onclick="createCookie('version', '5.1', 365);SwitchVersion('5.1');">Unreal Engine 5.1 Documentation</div>
		<div id="5_2" data-version="5.2" class="btn btn-select" onclick="createCookie('version', '5.2', 365);SwitchVersion('5.2');">Unreal Engine 5.2 Documentation</div>
		<div id="5_3" data-version="5.3" class="btn btn-select" onclick="createCookie('version', '5.3', 365);SwitchVersion('5.3');">Unreal Engine 5.3 Documentation</div>
	</div>
</span>
	<span class="separator">></span> <a id="parent_link" href="../../../../../../API">Unreal Engine API Reference</a>

	<span class="separator">></span> <a id="parent_link" href="../../../../../Runtime">Runtime</a>

	<span class="separator">></span> <a id="parent_link" href="../../../../Engine">Engine</a>

	<span class="separator">></span> <a id="parent_link" href="../../../Net">Net</a>

	<span class="separator">></span> <a id="parent_link" href="../../FObjectReplicator">FObjectReplicator</a>

<span class="separator">></span> <span id="page">FObjectReplicator::ReceivedNak</span>
</div>				<div id="pageNavRight">
								<!-- Start of Search -->
												<div id="search_container">
					<form name="bodySearch" method="get" action="https://www.unrealengine.com/en-US/bing-search" onsubmit="return validateSearch()">
						<input type="image" src="./../../../../../../../Include/Images/search_box_icon.png" class="searchbutton"/>
						<input type="hidden" name="filter" value="Documentation" />
						<input type="text" name="keyword" placeholder="Search Documentation..." class="searchbox" autocomplete="off"/>
					</form>
				</div>
								<!-- End of Search -->
				<div id="skinContainer">
	<div id="skinSelect" class="btn btn-skin" onclick="ToggleMenu($('#skinMenu'), $(this));"></div>
	<div id="skinMenu">
		<div id="light" class="btn btn-select" onclick="createCookie('skin', 'light', 365);location.reload();">Light Theme</div>
		<div id="dark" class="btn btn-select" onclick="createCookie('skin', 'dark', 365);location.reload();">Dark Theme</div>
	</div>
</div>				</div>
			</div>
		</div>						<div id="navWrapper">
			<div id="nav-filter-container">
				<div id="nav-filter-inner">
					<form>
						<input type="text" placeholder="Filter pages..." id="nav-filter" onchange="clearTimeout(filterTimer); filterTimer = setTimeout(updateNavTreeFilter,250, this.value);if(this.value.length == 0){$('#filter-clear').hide();}else{$('#filter-clear').show();}" onkeypress="this.onchange();" onpaste="this.onchange();" oninput="this.onchange();" />
						<button class="close-icon" id="filter-clear" type="reset" onclick="clearTimeout(filterTimer); filterTimer = setTimeout(updateNavTreeFilter,250, '');$(this).hide();"></button>
					</form>
				</div>
			</div>
			<nav id="navPanel">
			</nav>
			<div id="navigation" title="Click to toggle navigation menu"><span>></span></div>
		</div>		
		<div id="splitter">
		</div>
				<div id="contentContainer">
										<div id="pagedefault">
				<div id="product-banner">
	<div id="product-logo"></div>
</div>				<div id="pagecontainer" style="padding-right:0px;">
					<!-- Start of Markdown converted page content -->
										<div class="hero  background">
	<div class="imgContainer"><img src="./../../../../../../../Images/ue5-hero.png" /></div>	<div class="info">
		<div id="pageTitle">
			<h1 id="H1TitleId">FObjectReplicator::ReceivedNak</h1>
		</div>
		<h2 >Packet was dropped</h2>
		<div id="access">
			<div class="accessContainer">
															</div>
		</div>
	</div>
</div>															<div id="maincol">
																																				<div class="heading expanded" onclick="sectionOnClick(this, 'references');">
        <p>References</p>
    </div>
<div id="references">
    <div class="member-list">
	<table cellspacing="0">
		<tr class="normal-row">
	<td class="name-cell">
		<p>Module</p>
	</td>
	<td class="desc-cell">
		<p><a id="content_link" href="../../.." ><span>Engine</span></a></p>
	</td>
</tr>
		<tr class="normal-row">
	<td class="name-cell">
		<p>Header</p>
	</td>
	<td class="desc-cell">
		<p>&#47;Engine&#47;Source&#47;Runtime&#47;Engine&#47;Public&#47;Net&#47;DataReplication.h</p>
	</td>
</tr>
		<tr class="normal-row">
	<td class="name-cell">
		<p>Include</p>
	</td>
	<td class="desc-cell">
		<p>&#35;include &quot;Net&#47;DataReplication.h&quot;</p>
	</td>
</tr>
		<tr class="normal-row">
	<td class="name-cell">
		<p>Source</p>
	</td>
	<td class="desc-cell">
		<p>&#47;Engine&#47;Source&#47;Runtime&#47;Engine&#47;Private&#47;DataReplication.cpp</p>
	</td>
</tr>
			</table>
</div>

</div><div class="heading expanded" onclick="sectionOnClick(this, 'syntax');">
        <p>Syntax</p>
    </div>
<div id="syntax">
    <div class="simplecode_api">
	<p>void ReceivedNak<br />&#40;<br />&nbsp;&nbsp;&nbsp;&nbsp;int32 NakPacketId<br />&#41;  </p>
</div>
</div><div class="heading expanded" onclick="sectionOnClick(this, 'description');">
        <p>Remarks</p>
    </div>
<div id="description">
    <p>Packet was dropped
</p><p>Handling NAKs / Property Retransmission.
</p><p>Note, NACK handling only occurs on connections that "replicate" data, which is currently only Servers. RPC retransmission is handled elsewhere.
</p><p>RepLayouts: As we send properties through FRepLayout the is a Changelist Manager that is shared
between all connections tracks sets of properties that were recently changed (history items),
as well as one aggregate set of all properties that have ever been sent.
</p><p>Each Sending Rep State, which is connection unique, also tracks the set of changed
</p><ol ><li class="Default"><p>These history items will only be created when replicating the object,
so there will be fewer of them in general, but they will still contain any properties
that compared differently (not &#42;just&#42; the properties that were actually replicated).
</p></li></ol><p>Whenever a NAK is received, we will iterate over the SendingRepState changelist
and mark any of the properties sent in the NAKed packet for retransmission.
</p><p>The next time Properties are replicated for the Object, we will merge in any changelists
from NAKed history items.
</p><p>Custom Delta Properties: For Custom Delta Properties (CDP), we rely primarily on FPropertyRetirements and INetDeltaBaseState
for tracking property retransmission.
</p><p>INetDeltaBaseStates are used to tracked internal state specific to a given type of CDP.
For example, Fast Array Replicators will use FNetFastTArrayBaseState, or some type
derived from that.
</p><p>When an FObjectReplicator is created, we will create an INetDeltaBaseState for every CDP,
as well as a dummy FPropertyRetirement. This Property Retirement is used as the head
of a linked list of Retirements, and is generally never populated with any useful information.
</p><p>Every time we replicate a CDP, we will pass in the most recent Base State, and we will be
returned a new CDP. If data is actually sent, then we will create a new Property Retirement,
adding it as the tail of our linked list. The new Property Retirement will also hold a reference
to the old INetDeltaBaseState (i.e., the state of the CDP before it replicated its properties).
</p><p>Just before replicating, we will go through and free any ACKed FPropertyRetirments (see
UpdateAckedRetirements).
</p><p>After replicating, we will cache off the returned Base State to be used as the "old" state
the next time the property is replicated.
</p><p>Whenever a NAK is received, we will run through our Property Retirements. Any retirements
that predate the NACK will be removed and treated as if they were ACKs. The first
retirement that is found to be within the NAKed range will have its INetDeltaBaseState
restored (which should be the state before the NAKed packet was sent), and then
that retirement as well as all remaining will be removed.
</p><p>The onus is then on the CDP to resend any necessary properties based on its current / live
state and the restored Net Delta Base State.
</p><p>Fast Array Properties: Fast Array Properties are implemented as Custom Delta Properties (CDP). Therefore, they mostly
follow the flow laid out above.
</p><p>FNetFastTArrayBaseState is the basis for all Fast Array Serializer INetDeltaBaseStates.
This struct tracks the Replication Key of the Array, the ID to Replication Key map of individual
Array Items, and a History Number.
</p><p>As we replicate Fast Array Properties, we use the Array Replication key to see if anything
is possibly dirty in the Array and the ID to Replication map to see which Array Element
items actually are dirty. A mismatch between the Net Base State Key and the Key stored on
the live Fast Array (either the Array Replication Key, or any Item Key) is how we determine
if the Array or Items is dirty.
</p><p>Whenever a NAK is received, our Old Base State will be reset to the last known ACKed value,
as described in the CDP section above. This means that our Array Replication Key and ID To
Item Replication Key should be reset to those states, forcing a mismatch the next time we
replicate if anything has changed.
</p><p>When net.SupportFastArrayDelta is enabled, we perform an additional step in which we actually
compare the properties of dirty items. This is very similar to normal Property replication
using RepLayouts, and leverages most of the same code.
</p><p>This includes tracking history items just like Rep Layout. Instead of tracking histories per
Sending Rep State / Per Connection, we just manage a single set of Histories on the Rep
Changelist Mgr. Changelists are stored per Fast Array Item, and are referenced via ID.
</p><p>Whenever we go to replicate a Fast Array Item, we will merge together all changelists since
we last sent that item, and send those accumulated changes.
</p><p>This means that property retransmission for Fast Array Items is an amalgamation of Rep Layout
retransmission and CDP retransmission.
</p><p>Whenever a NAK is received, our History Number should be reset to the last known  ACKed value,
and that should be enough to force us to accumulate any of the NAKed item changelists.</p>
</div><div class="syntax">
	
</div>
																	</div>
					<!-- End of Markdown converted page content -->
				</div>
												<div id="recommendations"></div>			</div>
						<div id="footer"></div>			
									<div id="announcement">
			<div style="display:inline-block;margin:5px;">
				Help shape the future of Unreal Engine documentation! Tell us how we're doing so we can serve you better.
			</div>
			<div style="margin:5px;display:inline-block;">
				<div class="btn action" style="margin-top:-6px;display:inline-block;" onclick="$('#announcement').hide();window.open('https://epicgames.questionpro.com/t/AVVbJZwedR');createCookie('announcement-read', new Date().getTime(), 30);">Take our survey</div>
				<div class="btn btn-default" style="margin-top:-6px;display:inline-block;" onclick="$('#announcement').hide();createCookie('announcement-read', new Date().getTime(), 30);">Cancel</div>
			</div>
			<div class="btn-close" style="position:absolute;right:5px;top:10px;padding:3px;width:14px;height:14px;" onclick="$('#announcement').hide();"></div>
			</div>
					</div>
	</div>
</body>
</html>
